import{i as j,a3 as S,o as p,r as y,j as e,G as l,t as h,T as I,l as w}from"./index-DcevCD6o.js";import{A as F,F as D}from"./index.esm-CXJdHnCh.js";import{_ as A}from"./lodash-yhAUicQW.js";import{C}from"./index-nHH2RS1P.js";import{Q as z}from"./index-C4P_6ddA.js";import{E}from"./index-sddNJSNe.js";import{B as k}from"./Button-C-M37cBg.js";import"./Overflow-CH6O3Uu8.js";import"./useForkRef-x2dx1W7p.js";const $=n=>{switch(new Date(`${n}`).getMonth()+1){case 1:return"January";case 2:return"February";case 3:return"March";case 4:return"April";case 5:return"May";case 6:return"June";case 7:return"July";case 8:return"August";case 9:return"September";case 10:return"October";case 11:return"November";default:return"December"}},O=n=>{const{subscription:f,choice:m}=j(a=>a.event),o=S({queryKey:["assignedDevice"],queryFn:()=>p.post("/receiver/receiver-assigned-list",{user:n.info.consumerInfo.email,eventSelected:m}),refetchOnMount:!1});if(y.useEffect(()=>{const a=new AbortController;return o.refetch(),()=>{a.abort()}},[]),n){const a=r=>String(r).toLowerCase().includes("cash")?`pi_cash_amount_${String(r).split("**").at(-1)}`:r,v=r=>e.jsx("span",{style:{borderRadius:"16px",justifyContent:"center",display:"flex",padding:"2px 8px",alignItems:"center",background:`${r?"var(--blue-50, #EFF8FF)":"var(--success-50, #ECFDF3)"}`,width:"fit-content"},children:e.jsxs(I,{color:`${r?"var(--blue-700, #175CD3)":"var(--success-700, #027A48)"}`,fontSize:"12px",fontFamily:"Inter",fontStyle:"normal",fontWeight:500,lineHeight:"18px",textAlign:"center",textTransform:"capitalize",children:[e.jsx(h,{icon:"tabler:point-filled",rotate:3,color:`${r?"#2E90FA":"#12B76A"}`}),r?"Completed":"Active"]})}),x=()=>{const{device:r}=n.info;let s=[];for(let t of r)s=[...s,Number(t.deviceNeeded)];return s.reduce((t,i)=>t+i,0)},d=()=>{if(o.data){const r=A.groupBy(o.data.data.listOfReceivers,"paymentIntent");if(r[n.info.paymentIntent]){let s=[],t=0,i=1;const c=0;for(let u of r[n.info.paymentIntent])u.device.status===!0&&(s.splice(t,c,i),t++);return s.reduce((u,b)=>u+b,0)}else return 0}return 0},g=new Date;return e.jsx(C,{title:`${n.info.date?`${$(n.info.date)} ${new Date(n.info.date).getDate()}, ${new Date(n.info.date).getFullYear()}
              `:g}`,extra:v(n.active),style:{width:300,margin:"0.5rem auto 1rem"},styles:{header:{borderBottom:"transparent",color:"#6941c6"}},children:e.jsxs(l,{container:!0,children:[e.jsx(l,{display:"flex",justifyContent:"flex-start",alignItems:"center",margin:"0 0 -15px",item:!0,xs:10,children:e.jsxs("p",{style:{width:"100%",alignSelf:"stretch",color:"var(--gray-900, #101828)",fontSize:"18px",fontFamily:"Inter",fontStyle:"normal",fontWeight:700,lineHeight:"28px",textAlign:"left",textTransform:"none"},children:["Total devices: ",x()]})}),e.jsxs(l,{display:"flex",justifyContent:"space-between",alignItems:"center",margin:"0 0 -15px",item:!0,xs:12,children:[e.jsxs("p",{style:{width:"100%",alignSelf:"stretch",color:"var(--gray-600, #475467)",fontSize:"16px",fontFamily:"Inter",fontStyle:"normal",fontWeight:400,lineHeight:"24px",textAlign:"left",textTransform:"none"},children:[x()>1?"Devices":"Device"," in use:"," ",d(),"/",x()]}),d()>0?e.jsx(h,{icon:"fluent:shifts-activity-20-filled",width:25,color:"#ff0000"}):e.jsx(h,{icon:"ei:check",width:30,color:"#6ce792"})]}),e.jsx(l,{display:"flex",justifyContent:"flex-start",alignItems:"center",item:!0,xs:10,children:e.jsxs("p",{style:{width:"100%",alignSelf:"stretch",color:"var(--gray-600, #475467)",fontSize:"16px",fontFamily:"Inter",fontStyle:"normal",fontWeight:400,lineHeight:"24px",textAlign:"left",textTransform:"none"},children:["Deposit amount: ",f.id===1?"$0":null]})}),e.jsx(l,{display:"flex",justifyContent:"center",alignItems:"center",margin:"0.5rem auto",item:!0,xs:10,children:e.jsx(z,{errorLevel:"H",value:`${n.info.paymentIntent}`,icon:"https://devitrakadmindashboardlogotesting.s3.amazonaws.com/maskable_icon_white_background.png",iconSize:50})}),e.jsxs("p",{style:{width:"100%",alignSelf:"stretch",color:"var(--gray-600, #475467)",fontSize:"14px",fontFamily:"Inter",fontStyle:"normal",fontWeight:400,lineHeight:"20px",textAlign:"center",textTransform:"none"},children:["Order number: ",a(n.info.paymentIntent)]})]})})}else return[]},L=()=>{var r,s;const{consumer:n}=j(t=>t.consumer),f=w(),m=new Date;m.setFullYear(m.getFullYear()-1);const o=S({queryKey:["transactions"],queryFn:()=>p.post("/transaction/transaction",{"consumerInfo.email":n.email,created_at:{$gte:new Date(m).getTime()}}),refetchOnMount:!1});y.useEffect(()=>{const t=new AbortController;return o.refetch(),()=>{t.abort()}},[]);const a=(s=(r=o==null?void 0:o.data)==null?void 0:r.data)==null?void 0:s.list;y.useCallback(()=>{if(a){const t={};for(let i of a)t[i.paymentIntent]?p.delete(`/transaction/remove-duplicate-transaction/${i.id}`):t[i.paymentIntent]=i}},[a])();const x=()=>f(n?"/deviceSelection":"/initial-form"),d=()=>{var t,i,c,u;return Array.isArray((i=(t=o==null?void 0:o.data)==null?void 0:t.data)==null?void 0:i.list)&&((u=(c=o==null?void 0:o.data)==null?void 0:c.data)==null?void 0:u.list.length)>0?a.toReversed():[]},g=({index:t,style:i})=>{const c=d()[t];return e.jsx("div",{style:i,children:e.jsx(O,{info:c})},c.id)};return e.jsxs(l,{display:"flex",flexDirection:"column",alignItems:"center",margin:"0.5rem auto 4rem",container:!0,children:[e.jsxs(l,{display:"flex",flexDirection:"column",alignItems:"center",margin:"2rem auto 2rem",item:!0,xs:10,children:[e.jsx("h1",{style:{color:"var(--gray-900, #101828)",textAlign:"center",fontFamily:"Inter",fontSize:"24px",fontStyle:"normal",fontWeight:"600",lineHeight:"32px"},children:"Order details"}),e.jsx("h4",{style:{color:"var(--gray-600, #475467)",textAlign:"center",fontFamily:"Inter",fontSize:"16px",fontStyle:"normal",fontWeight:"400",lineHeight:"24px"},children:"View your current orders and request more."})]}),e.jsx(l,{display:"flex",flexDirection:"column",alignItems:"center",margin:"1rem auto 0rem",item:!0,xs:10,children:n.email&&d().length>0?e.jsx("div",{style:{flex:"1 1 auto",width:300,height:450},children:e.jsx(F,{children:({scaledWidth:t,scaledHeight:i})=>e.jsx(D,{height:i,itemCount:d().length,itemSize:450,width:t,children:g})})}):e.jsx(E,{description:e.jsx("h1",{style:{color:"var(--gray-600, #475467)",textAlign:"center",fontFamily:"Inter",fontSize:"16px",fontStyle:"normal",fontWeight:"400",lineHeight:"24px"},children:"No order."})})}),e.jsx(l,{display:"flex",alignItems:"center",justifyContent:"center",margin:"1rem auto 0rem",width:"100%",item:!0,xs:10,children:e.jsx(k,{onClick:()=>x(),style:{display:"flex",padding:"12px 20px",justifyContent:"center",alignItems:"center",borderRadius:"8px",border:"1px solid var(--blue-dark-600, #155EEF)",background:"var(--blue-dark-600, #155EEF)",boxShadow:"0px 1px 2px 0px rgba(16, 24, 40, 0.05)",width:"100%"},children:e.jsx(I,{style:{textTransform:"none",fontFamily:"Inter",fontSize:"18px",fontStyle:"normal",fontWeight:600,lineHeight:"20px",color:"#fff"},children:"Create new order"})})})]})};export{L as default};
