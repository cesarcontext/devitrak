import{D as h,a5 as j,J as v,r as I,j as e,G as o,T as a,I as y,bb as b,F as w}from"./index-CfIzPxVU.js";import{C as D}from"./index-C5mXj48Q.js";import{Q as F}from"./index-CyIM1fkr.js";import{E as A}from"./index-B0laTGyl.js";import{B as C}from"./Button-ZKTpBfP7.js";import"./EllipsisOutlined-Bnb-vHKa.js";import"./KeyCode-CDH7NaE-.js";import"./Overflow-ugpi8Y_m.js";import"./index-Bm9gYaKe.js";import"./useForkRef-D4L1EbnA.js";const z=n=>{switch(new Date(`${n}`).getMonth()+1){case 1:return"January";case 2:return"February";case 3:return"March";case 4:return"April";case 5:return"May";case 6:return"June";case 7:return"July";case 8:return"August";case 9:return"September";case 10:return"October";case 11:return"November";default:return"December"}},k=n=>{const{subscription:m,choice:u}=h(r=>r.event),c=j({queryKey:["assignedDevice"],queryFn:()=>v.post("/receiver/receiver-assigned-list",{user:n.info.consumerInfo.email,eventSelected:u}),enabled:!1,refetchOnMount:!1});if(I.useEffect(()=>{const r=new AbortController;return c.refetch(),()=>{r.abort()}},[]),n){const r=s=>e.jsx("span",{style:{borderRadius:"16px",justifyContent:"center",display:"flex",padding:"2px 8px",alignItems:"center",background:"var(--success-50, #ECFDF3)",width:"fit-content"},children:e.jsxs(a,{color:"var(--success-700, #027A48)",fontSize:"12px",fontFamily:"Inter",fontStyle:"normal",fontWeight:500,lineHeight:"18px",textAlign:"center",textTransform:"capitalize",children:[e.jsx(y,{icon:"tabler:point-filled",rotate:3,color:"#12B76A"}),"Active"]})}),x=()=>{const{device:s}=n.info;let l=[],t=0;const i=0;for(let f of s)l.splice(t,i,f.deviceNeeded),t++;return l.reduce((f,d)=>f+d,0)},p=()=>{if(c.data){const s=b.groupBy(c.data.data.listOfReceivers,"paymentIntent");if(s[n.info.paymentIntent]){let l=[],t=0,i=1;const f=0;for(let d of s[n.info.paymentIntent])d.device.status===!0&&(l.splice(t,f,i),t++);return l.reduce((d,S)=>d+S,0)}else return 0}return 0},g=new Date;return e.jsx(D,{title:`${n.info.date?`${z(n.info.date)} ${new Date(n.info.date).getDate()}, ${new Date(n.info.date).getFullYear()}
              `:g}`,extra:r(),style:{width:300,margin:"0.5rem auto 1rem"},children:e.jsxs(o,{container:!0,children:[e.jsx(o,{display:"flex",justifyContent:"flex-start",alignItems:"center",item:!0,xs:10,children:e.jsxs(a,{width:"100%",alignSelf:"stretch",color:"var(--gray-900, #101828)",fontSize:"18px",fontFamily:"Inter",fontStyle:"normal",fontWeight:500,lineHeight:"28px",textAlign:"left",textTransform:"capitalize",children:["Total devices: ",x()]})}),e.jsxs(o,{display:"flex",justifyContent:"space-between",alignItems:"center",item:!0,xs:12,children:[e.jsxs(a,{width:"100%",alignSelf:"stretch",color:"var(--gray-600, #475467)",fontSize:"16px",fontFamily:"Inter",fontStyle:"normal",fontWeight:400,lineHeight:"24px",textAlign:"left",textTransform:"capitalize",children:[x()>1?"Devices":"Device"," in use:"," ",p(),"/",x()]}),p()>0?e.jsx(y,{icon:"fluent:shifts-activity-20-filled",width:25,color:"#ff0000"}):e.jsx(y,{icon:"ei:check",width:30,color:"#6ce792"})]}),e.jsx(o,{display:"flex",justifyContent:"flex-start",alignItems:"center",item:!0,xs:10,children:e.jsxs(a,{width:"100%",alignSelf:"stretch",color:"var(--gray-600, #475467)",fontSize:"16px",fontFamily:"Inter",fontStyle:"normal",fontWeight:400,lineHeight:"24px",textAlign:"left",textTransform:"capitalize",children:["Deposit amount: ",m.id===1?"$0":null]})}),e.jsx(o,{display:"flex",justifyContent:"center",alignItems:"center",item:!0,xs:10,children:e.jsx(a,{width:"100%",color:"",fontSize:"12px",fontFamily:"Inter",fontStyle:"normal",fontWeight:500,lineHeight:"18px",textAlign:"left",textTransform:"capitalize"})}),e.jsx(o,{display:"flex",justifyContent:"center",alignItems:"center",margin:"0.5rem auto",item:!0,xs:10,children:e.jsx(F,{errorLevel:"H",value:`${n.info.paymentIntent}`,icon:"https://i.ibb.co/kKktFyw/maskable-icon.png",iconSize:50})}),e.jsxs(a,{width:"100%",alignSelf:"stretch",color:"var(--gray-600, #475467)",fontSize:"14px",fontFamily:"Inter",fontStyle:"normal",fontWeight:400,lineHeight:"20px",textAlign:"center",textTransform:"none",children:["Order number: ",n.info.paymentIntent]})]})})}else return[]},J=()=>{var g,s,l;const{consumer:n}=h(t=>t.consumer),{choice:m}=h(t=>t.event),u=w(),c=j({queryKey:["transactions"],queryFn:()=>v.get("/stripe/transaction")}),r=(l=(s=(g=c==null?void 0:c.data)==null?void 0:g.data)==null?void 0:s.list)==null?void 0:l.filter(t=>{var i;return((i=t==null?void 0:t.consumerInfo)==null?void 0:i.email)===(n==null?void 0:n.email)&&t.eventSelected===m});I.useCallback(()=>{if(r){const t={};for(let i of r)t[i.paymentIntent]?v.delete(`/transaction/remove-duplicate-transaction/${i.id}`):t[i.paymentIntent]=i}},[r])();const p=()=>u(n?"/deviceSelection":"/initial-form");return e.jsxs(o,{display:"flex",flexDirection:"column",alignItems:"center",margin:"0.5rem auto 4rem",container:!0,children:[e.jsxs(o,{display:"flex",flexDirection:"column",alignItems:"center",margin:"2rem auto 2rem",item:!0,xs:10,children:[e.jsx(a,{color:"var(--gray-900, #101828)",textAlign:"center",fontFamily:"Inter",fontSize:"24px",fontStyle:"normal",fontWeight:"600",lineHeight:"32px",children:"Order details"}),e.jsx(a,{color:"var(--gray-600, #475467)",textAlign:"center",fontFamily:"Inter",fontSize:"16px",fontStyle:"normal",fontWeight:"400",lineHeight:"24px",children:"View your current orders and request more."})]}),e.jsx(o,{display:"flex",flexDirection:"column",alignItems:"center",margin:"1rem auto 0rem",item:!0,xs:10,children:n&&r?r==null?void 0:r.toReversed().map(t=>e.jsx("span",{children:e.jsx(k,{info:t})},t.id)):e.jsx(A,{description:e.jsx(a,{color:"var(--gray-600, #475467)",textAlign:"center",fontFamily:"Inter",fontSize:"16px",fontStyle:"normal",fontWeight:"400",lineHeight:"24px",children:"No order."})})}),e.jsx(o,{display:"flex",alignItems:"center",justifyContent:"center",margin:"1rem auto 0rem",width:"100%",item:!0,xs:10,children:e.jsx(C,{onClick:()=>p(),style:{display:"flex",padding:"12px 20px",justifyContent:"center",alignItems:"center",gap:"8px",borderRadius:"8px",border:"1px solid var(--blue-dark-600, #155EEF)",background:"var(--blue-dark-600, #155EEF)",boxShadow:"0px 1px 2px 0px rgba(16, 24, 40, 0.05)",width:"100%"},children:e.jsx(a,{textTransform:"none",fontFamily:"Inter",fontSize:"18px",fontStyle:"normal",fontWeight:600,lineHeight:"20px",color:"#fff",children:"Create new order"})})})]})};export{J as default};
